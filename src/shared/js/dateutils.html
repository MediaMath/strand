<link rel="import" href="moment.html">
<link rel="import" href="datautils.html">
<script>
	(function(scope) {
		var DataUtils = StrandLib.DataUtils;

		function _ensureMoment(d) {
			if(moment.isMoment(d)) {
				// Already a moment object
				return d;
			} else if(DataUtils.isType(d, 'date')) {
				// Construct moment from date
				return moment(d);
			} else if(DataUtils.isType(d, 'string')) {
				// Attempt to parse datestring
				return moment(new Date(d));
			} else if(Number.isFinite(d)) {
				// Construct moment from timestamp
				return moment.unix(d);
			} else {
				// If all else fails return an invalid moment
				return moment('Invalid date','Invalid date',true);
			}
		}

		function _clampDates(value, lower, upper) {
			var tmp = _ensureMoment(value);
			if(lower) tmp = moment.max(_ensureMoment(lower), tmp);
			if(upper) tmp = moment.min(_ensureMoment(upper), tmp);
			return tmp;
		}

		scope.DateUtils = {
			ensureMoment: _ensureMoment,
			clampDates: _clampDates
		}
	}(window.StrandLib = window.StrandLib || {}))
</script>
<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script src="TestHelper.js"></script>
	<script>
		var should = chai.should();
	</script>
	<link rel="import" href="../build/strand.html">
</head>
<body>

<strand-filter id="mmfilter_1" search-mode="simple"> </strand-filter>
<hr>
<strand-filter id="mmfilter_2" search-mode="advance"></strand-filter>


<script type="text/javascript">
	function initAndSetData(control){

		control.set('data',
				[
					{
						"id": 1,
						"gender": "Male",
						"first_name": "Keith",
						"last_name": "Foster",
						"age": 57,
						"email": "kfoster0@behance.net",
						"company_Name": "Bubblemix",
						"salary": "$5.73",
						"city": "Hrastnik",
						"country": "Slovenia",
						"position": "VP Product Management",
						"body_size": "XL"
					},
					{
						"id": 2,
						"gender": "Male",
						"first_name": "Henry",
						"last_name": "Morales",
						"age": 25,
						"email": "hmorales1@cloudflare.com",
						"company_Name": "Voolia",
						"salary": "$2.83",
						"city": "Panguipulli",
						"country": "Chile",
						"position": "VP Sales",
						"body_size": "XL"
					},
					{
						"id": 3,
						"gender": "Male",
						"first_name": "Stephen",
						"last_name": "Ramos",
						"age": 46,
						"email": "sramos2@japanpost.jp",
						"company_Name": "Miboo",
						"salary": "$4.13",
						"city": "Brudzew",
						"country": "Poland",
						"position": "Health Coach II",
						"body_size": "XL"
					},
					{
						"id": 4,
						"gender": "Female",
						"first_name": "Laura",
						"last_name": "Hernandez",
						"age": 13,
						"email": "lhernandez3@ocn.ne.jp",
						"company_Name": "Jabbercube",
						"salary": "$2.17",
						"city": "Satsumasendai",
						"country": "Japan",
						"position": "Chief Design Engineer",
						"body_size": "2XL"
					},
					{
						"id": 5,
						"gender": "Male",
						"first_name": "Johnny",
						"last_name": "Ross",
						"age": 9,
						"email": "jross4@slideshare.net",
						"company_Name": "Shufflebeat",
						"salary": "$2.96",
						"city": "Dobrošte",
						"country": "Macedonia",
						"position": "Programmer Analyst II",
						"body_size": "XS"
					},
					{
						"id": 6,
						"gender": "Male",
						"first_name": "Clarence",
						"last_name": "Watkins",
						"age": 27,
						"email": "cwatkins5@eepurl.com",
						"company_Name": "Zoombox",
						"salary": "$8.98",
						"city": "Gancheng",
						"country": "China",
						"position": "Assistant Professor",
						"body_size": "M"
					},
					{
						"id": 7,
						"gender": "Female",
						"first_name": "Judy",
						"last_name": "Spencer",
						"age": 42,
						"email": "jspencer6@hc360.com",
						"company_Name": "Roomm",
						"salary": "$8.50",
						"city": "Spárti",
						"country": "Greece",
						"position": "Web Developer I",
						"body_size": "M"
					},
					{
						"id": 8,
						"gender": "Female",
						"first_name": "Joan",
						"last_name": "Shaw",
						"age": 30,
						"email": "jshaw7@blinklist.com",
						"company_Name": "Nlounge",
						"salary": "$7.29",
						"city": "San Nicolas",
						"country": "Philippines",
						"position": "Human Resources Assistant III",
						"body_size": "3XL"
					},
					{
						"id": 9,
						"gender": "Female",
						"first_name": "Bonnie",
						"last_name": "Lopez",
						"age": 19,
						"email": "blopez8@globo.com",
						"company_Name": "Livefish",
						"salary": "$5.81",
						"city": "Ust’-Kut",
						"country": "Russia",
						"position": "Analyst Programmer",
						"body_size": "L"
					},
					{
						"id": 10,
						"gender": "Male",
						"first_name": "Brian",
						"last_name": "Robinson",
						"age": 19,
						"email": "brobinson9@telegraph.co.uk",
						"company_Name": "Oyondu",
						"salary": "$2.83",
						"city": "Dolní Dunajovice",
						"country": "Czech Republic",
						"position": "Director of Sales",
						"body_size": "XL"
					},
					{
						"id": 11,
						"gender": "Female",
						"first_name": "Bonnie",
						"last_name": "Lee",
						"age": 23,
						"email": "bleea@blogs.com",
						"company_Name": "Livepath",
						"salary": "$2.27",
						"city": "Akune",
						"country": "Japan",
						"position": "Marketing Assistant",
						"body_size": "3XL"
					},
					{
						"id": 12,
						"gender": "Male",
						"first_name": "Billy",
						"last_name": "Hanson",
						"age": 48,
						"email": "bhansonb@usda.gov",
						"company_Name": "Skivee",
						"salary": "$0.80",
						"city": "Sidowayah Lor",
						"country": "Indonesia",
						"position": "Recruiting Manager",
						"body_size": "S"
					},
					{
						"id": 13,
						"gender": "Male",
						"first_name": "Chris",
						"last_name": "Harper",
						"age": 1,
						"email": "charperc@example.com",
						"company_Name": "Chatterbridge",
						"salary": "$7.05",
						"city": "Tržič",
						"country": "Slovenia",
						"position": "Environmental Specialist",
						"body_size": "M"
					},
					{
						"id": 14,
						"gender": "Female",
						"first_name": "Annie",
						"last_name": "Banks",
						"age": 48,
						"email": "abanksd@ebay.com",
						"company_Name": "Quatz",
						"salary": "$3.24",
						"city": "Awsīm",
						"country": "Egypt",
						"position": "Nuclear Power Engineer",
						"body_size": "3XL"
					},
					{
						"id": 15,
						"gender": "Female",
						"first_name": "Deborah",
						"last_name": "Gilbert",
						"age": 36,
						"email": "dgilberte@sfgate.com",
						"company_Name": "Eare",
						"salary": "$3.25",
						"city": "Thị Trấn Hùng Quốc",
						"country": "Vietnam",
						"position": "Administrative Officer",
						"body_size": "L"
					}]);
		return control;
	}
	describe("strand-filter", function() {

		it("should have an element constructor", function() {
			var a = new Strand.filter();
			a.nodeName.should.equal("STRAND-FILTER");

		});

		it("should show add button in advance mode only.", function(done){
			var a = document.querySelector('strand-filter');
			a.searchMode = 'advance';
			var addOperationControl =  a.querySelector('.advanceWrapper');
			flush(function(){
				addOperationControl.hidden.should.equal(false	);
				a.set('searchMode','normal');
				addOperationControl =  a.querySelector('.advanceWrapper');
				addOperationControl.hidden.should.equal(true);
				done();
			})
		});


		it("should add searchconfig row by default in normal mode.", function(done){
			var a = new Strand.filter();
			initAndSetData(a);
			flush(function(){
				a.searchMode = 'simple';
				a.searchConfig.length.should.equal(1);

				var config = a.searchConfig[0];
				config.column.should.equal('ALL');
				console.log(config);
				should.not.exist(config.parent);
				config.logicalOperator.should.equal('AND');
				done();
			})
		});

		it("should add and delete a row in searchConfig.", function(done){
			var a = new Strand.filter();
			initAndSetData(a);
			flush(function(){
				a.searchMode = 'advance';
				var lengthEarlier = a.searchConfig.length;
				a._addConfig.call(a, {});
				a.searchConfig.length.should.equal(lengthEarlier + 1);
				a._addConfig.call(a, {model:{item:{parent:null, level:0, index:a.searchConfig.length-1}}});

				var length  = a.searchConfig.filter(function(item){
					return item.level ==1;
				}).length;

				length.should.equal(length);

				a._deleteConfig.call(a, {model:{index:0, id:0}});
				a.searchConfig.length.should.equal(2);
				done();
			})
		})

	});

</script>

</body>
</html>
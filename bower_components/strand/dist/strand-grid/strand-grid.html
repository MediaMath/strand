<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt
 --><html><head><meta charset="UTF-8"><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../strand-item-recycler/strand-item-recycler.html"><link rel="import" href="../strand-grid-column/strand-grid-column.html"><link rel="import" href="../strand-grid-item/strand-grid-item.html"><link rel="import" href="../strand-checkbox/strand-checkbox.html"><link rel="import" href="../strand-icon/strand-icon.html"><link rel="import" href="../strand-loader/strand-loader.html"></head><body><div hidden by-vulcanize=""><script>!function(t){var e={ready:function(){this.hasAttribute("unresolved")&&this.removeAttribute("unresolved")}};t.Resolvable=e}(window.StrandTraits=window.StrandTraits||{});</script><script>!function(i){var n=i.MixinFindable={properties:{mixinFindable:{type:Object,value:function(){return this},notify:!0}},mixinsForValue:function(i){return null},mixinsForValuePath:function(i,n){return null},prototypeAsMixin:function(i){var r={};Array.isArray(i.behaviors)&&i.behaviors.indexOf(n)<0?i.behaviors.push(n):i.behaviors||(i.behaviors=[n]);for(var t in i)r[t]=i[t];return i.mixinsForValue=function(){return r},i}}}(window.StrandTraits=window.StrandTraits||{});</script><script>!function(t){t.TemplateFindable={properties:{_templateFound:{type:Object,computed:"_computeTemplate(templateFinder, templateFinder.template)"},templateFinder:{type:Object,notify:!0},templateFindable:{type:Object,value:function(){return this},notify:!0},templatePriority:{type:Array,value:function(){return["lightdom","import","bind"]},notify:!0},templateBind:{type:Object,value:null,notify:!0},templateMatch:{type:String,value:"template:not([is])",notify:!0},templateSelector:{type:String,value:"",notify:!0},templateUri:{type:String,notify:!0},templateQuery:{type:String,value:"template:not([is])",notify:!0}},ready:function(){this.notifyPath("templateFindable.templatePriority",this.templatePriority),this.notifyPath("templateFindable.templateBind",this.templateBind),this.notifyPath("templateFindable.templateMatch",this.templateMatch),this.notifyPath("templateFindable.templateSelector",this.templateSelector),this.notifyPath("templateFindable.templateUri",this.templateUri),this.notifyPath("templateFindable.templateQuery",this.templateQuery)},_computeTemplate:function(t,e){return e},_computeTemplateContents:function(t,e){return e},hasTemplate:function(){return 0|!!this._templateFound}}}(window.StrandTraits=window.StrandTraits||{});</script><script>!function(t){var n={properties:{ref:{type:Object,notify:!0,readOnly:!0,value:function(){return this}}},findById:function(t){return this.$[t]||this.$$("#"+t)}};t.Refable=n}(window.StrandTraits=window.StrandTraits||{});</script></div><dom-module id="strand-grid"><template><style>:host ._mm_column{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 10px;vertical-align:middle;box-sizing:border-box;float:left;min-height:1px}:host ._mm_column.right{text-align:right}:host ._mm_column.checkbox,:host ._mm_column.toggle{box-sizing:content-box;margin:auto 0;padding:0 5px}:host ._mm_column.checkbox:first-of-type,:host ._mm_column.toggle:first-of-type{padding-left:15px}:host ._mm_column.checkbox{width:18px}:host ._mm_column.toggle{width:10px}:host ._mm_column.toggle strand-icon{cursor:pointer;transform:rotate(-90deg)}:host ._mm_column.toggle.expanded strand-icon{transform:rotate(0)}:host{display:block;position:relative;overflow:hidden;min-height:300px}:host([recycle=false]){min-height:0}:host([recycle=false]) #viewport{position:static}#footer,#header{display:-ms-flexbox;display:flex;min-width:100%;background:#e0e0e0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#header{top:0}#footer{bottom:0}#viewport{height:100%;width:100%;top:0;bottom:0;overflow:auto;background:#fff}#separator{display:none;transform:translateZ(0);position:absolute;top:0;height:100%;padding:0 50px;margin-left:-50px;cursor:col-resize}#separator:after{display:block;content:"";width:2px;height:100%;background-color:rgba(0,0,0,.3)}#separator.visible{display:block}#loader{width:130px;height:28px;margin:auto;position:relative}#columnContainer{display:-ms-flexbox;display:flex;-ms-flex:1;flex:1;width:100%}</style><strand-item-recycler id="viewport" gpu="{{gpu}}" data="{{data}}" scope="{{scope}}" index="{{index}}" template-finder="{{templateFinder}}" template-findable="{{templateFindable}}" mixin-findable="{{mixinFindable}}" measuring="{{_measuring}}"><div id="header" recycler="header"><div class="_mm_column checkbox" hidden$="{{!selectable}}"><strand-checkbox id="selectAll" on-tap="_toggleAllSelections" state="{{_selectAllState}}"></strand-checkbox></div><div id="carat" class="_mm_column toggle" hidden$="{{!expandable}}"><strand-icon width="10" height="10" type="expand-all" on-tap="_toggleAllExpansions"></strand-icon></div><div id="columnContainer"><content id="columns" select="strand-grid-column"></content></div></div><strand-loader id="loader" recycler="overlay" style$="{{_loaderStyle}}"><label>Loading...</label></strand-loader><content select="template:not([is])"></content><template preserve-content=""><strand-grid-item model="{{model}}" scope="{{scope}}" index="{{index}}"></strand-grid-item></template></strand-item-recycler><div id="separator"></div></template></dom-module><script>!function(t){function e(t,e){return t.reduce(function(t,n){return t[n[e]]=n,t},{})}t.Grid=Polymer({is:"strand-grid",properties:{gpu:{type:String,value:"2d"},data:Array,scope:{type:Object,notify:!0,value:function(){return this}},index:{type:Number,notify:!0},_selectAllState:{type:String,value:"unchecked"},sortField:{type:String,notify:!0},sortOrder:{type:Number,value:1,notify:!0},indicate:{type:String,value:"loading  measuring"},_indications:{type:Object,value:null,computed:"_computeIndications(indicate)"},_loaderStyle:{type:String,computed:"_styleLoader(_indications, isLoading, _measuring)"},isLoading:{type:Boolean,value:!1},_measuring:{type:Boolean},expanded:{type:Boolean,value:!1},selectable:{type:Boolean,value:!1,observer:"_selectableChanged"},expandable:{type:Boolean,value:!1,observer:"_expandableChanged"},_columns:{type:Array,value:function(){return[]},notify:!0,observer:"_columnsChanged"},_columnCount:{type:Number,value:0,notify:!0},mutationTarget:{type:Object,value:function(){return this.$.columnContainer}},icon:{type:String,value:null,notify:!0}},behaviors:[StrandTraits.Resolvable,StrandTraits.MixinFindable,StrandTraits.TemplateFindable,StrandTraits.Refable,StrandTraits.DomMutable],listeners:{"column-resize-start":"_onColumnResizeStart","column-resize":"_onColumnResize","column-resize-end":"_onColumnResizeEnd","column-sort":"_onColumnSort","item-selected":"_onItemSelected",added:"_initialize",removed:"_initialize",modified:"_initialize"},observers:["_expansionChanged(expanded)","_onSortChanged(sortField, sortOrder, _columnCount)"],_expansionChanged:function(t){this.toggleClass("expanded",!!t,this.$.carat)},attached:function(){this.async(this._initialize)},_initialize:function(){this._initializeColumns(),this._setInitialColumnWidth(),this._columnCount++},_initializeColumns:function(){var t=Polymer.dom(this.$.columns).getDistributedNodes();t.length>0&&(this._columns=Array.prototype.slice.call(t),this._columnsMap=e(this._columns,"field"))},_columnsChanged:function(){this._columnsMap=e(this._columns,"field"),this.notifyPath("scope._columns",this._columns)},_selectableChanged:function(){this.notifyPath("scope.selectable",this.selectable)},_expandableChanged:function(){this.notifyPath("scope.expandable",this.expandable)},_setInitialColumnWidth:function(){var t=this._columns.every(function(t){return null===t.width||void 0===t.width});if(t){var e=100/this._columns.length;this._columns.forEach(function(t){t.width=e+"%"})}},_onItemSelected:function(t,e,n){var i=this.selected,o=e,s=Array.isArray(this.data)?this.data.indexOf(o):-1,a="unchecked";i.length>0&&(a="partial"),i.length===this.data.length&&(a="checked"),o&&s>-1&&this.set("data."+s+".selected",o.selected),this._selectAllState=a},_toggleAllSelections:function(t){this.setAllSelections(t.target.checked)},setAllSelections:function(t){var e=!!t;this._selectAllState=e?"checked":"unchecked",this.data&&this.data.forEach(function(t,n){var i="data."+n+".selected";this.set(i,e)},this)},get selected(){return this.data&&this.data.filter(function(t){return t.selected})},_onColumnResizeStart:function(t){this._columnOffset=t.detail.val},_onColumnResize:function(t){var e=this._columnOffset+t.detail.val-this.$.viewport.scrollLeft;this.translate3d(e+"px",0,0,this.$.separator),this._showSeparator()},_showSeparator:function(){this.$.separator.classList.add("visible"),document.body.style.cursor="col-resize"},_hideSeparator:function(){this.$.separator.classList.remove("visible"),document.body.style.cursor=""},_onColumnResizeEnd:function(t){this._resizeColumns(t.detail.field,t.detail.val),this._hideSeparator()},_resizeColumns:function(t,e){var n=this._columnsMap[t];this._columns.indexOf(n);this._columns.forEach(function(t,e){-1!==t.width.indexOf("%")&&t.set("width",t.offsetWidth+"px"),this.notifyPath("scope._columns."+e+".width",t.width)},this)},_onSortChanged:function(){this.sortBy(this.sortField,this.sortOrder)},_onColumnSort:function(t){this.sortField=t.detail.field,this.sortOrder=t.detail.val},sortBy:function(t,e){var n=arguments.length>1?e:null;this._columns.forEach(function(e){e.sortOrder=e.SORT_DEFAULT,e.sortField===t&&(n===e.SORT_ASCENDING||n===e.SORT_DESCENDING?e.sortOrder=n:null===n&&(e.sortOrder=e.SORT_ASCENDING))})},_toggleAllExpansions:function(t,e,n){this.setAllExpansions(!this.expanded)},setAllExpansions:function(t){var e=!!t;this.set("expanded",e),this.$.viewport.inferOffviewHeightsAfterNextMutation(),this.data&&this.data.forEach(function(t,e){this.set("data."+e+".expanded",this.expanded)},this)},_computeIndications:function(){var t=(this.indicate||"").split(/\s+/);return t.reduce(function(t,e){return t[e]=1,t},{})},_styleLoader:function(t,e,n,i,o){var s="",a="display: none;",l=e&&t.loading?s:n&&t.measuring?s:i&&t.deferring?s:o&&t.initializing?s:a;return l},_showLoader:function(t,e,n){return e&&t.loading||n&&t.measuring},requestInitialization:function(){return this.$.viewport.initialize()},createId:function(t,e){return t+e},getAllColumns:function(){return Array.apply(null,Polymer.dom(this).querySelectorAll("strand-grid-column"))},getColumnByField:function(t){return Polymer.dom(this).querySelector("strand-grid-column[field="+t+"]")||null},insertBeforeColumn:function(t,e){return Polymer.dom(this).insertBefore(t,e)},removeColumn:function(t){return Polymer.dom(this).removeChild(t)}})}(window.Strand=window.Strand||{});</script></body></html>
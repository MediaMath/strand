<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt
 --><html><head><meta charset="UTF-8"></head><body><div hidden by-vulcanize=""><link rel="import" href="../../bower_components/polymer/polymer.html"><script>(function(a){var b={properties:{ref:{type:Object,notify:!0,readOnly:!0,value:function(){return this}}},findById:function(c){return this.$[c]||this.$$('#'+c)}};a.Refable=b})(window.StrandTraits=window.StrandTraits||{});</script><script>(function(a){function b(r,s){return Object.prototype.toString.call(r).toLowerCase()==="[object "+s.toLowerCase()+"]"}function c(r){return void 0!==r&&null!==r}function d(r){if(r)return Array.prototype.slice.call(r)}function f(r,s){return!s||-1===s.indexOf(r.name)}function g(r,s,u){var v={},w=d(r.attributes);return w&&(w.forEach(function(x){if(f(x,s))try{v[x.name]=JSON.parse(x.value)}catch(y){v[x.name]=""===x.value||x.value}}),r.innerHTML&&u&&(v.inner=r.innerHTML.trim())),v}function h(r,s){if(0===r.length)return{};var u,w,v=s||{};for(u=r.length-1;0<=u;u--)w=r[u],v[w.name]=w.value;return v}function k(r){var s=[];for(var u in r)s.push({name:u,value:r[u]});return s}function l(r){return r.value||r.inner}function m(r,s,u){return u=u||{},Object.keys(r).forEach(function(v){-1!==s.indexOf(v)&&(u[v]=r[v]),b(r[v],"object")&&m(r[v],s,u)}),u}function q(r){var s={};return Object.keys(r).forEach(function(u){s[u]=r[u]}),s}a.DataUtils={clone:d,copy:function(){var s=d(arguments),u=1<s.length?s.shift():{};return s.reduce(function(v,w){if(b(w,"object"))for(var x in w)v[x]=w[x];return v},u)},isType:b,objectifyAttributes:g,isDef:c,param:function(r,s){return{name:r,value:s}},packParams:h,unpackParams:k,// uniqueMergeParams: function() {
// 	return _uniqueMerge.apply(this, arguments);
// },
uniqueMergeParams:function(){var s={},u=d(arguments);return u.forEach(function(v){0<v.length&&h(v,s)}),k(s)},objectifyDistributedNodes:function(r){return r=d(r).filter(function(u){return u.nodeType===Node.ELEMENT_NODE}),r.reduce(function s(u,v){var w=v.nodeName.toLowerCase();return void 0===u[w]&&(u[w]=[]),0<v.children.length?u[w]=d(v.children).reduce(s,{}):u[w].push(g(v,null,!0)),u},{})},nodeInnerValue:l,nodeToParam:function(s){return{name:s.name,value:l(s)}},nodeCheckIf:function(s,u){if(s.conditional){c(s.if)&&JSON.parse(s.if);var v=c(s.if)&&JSON.parse(s.if);return v?u(s):null}return u(s)},mergeParamLists:function(){var r,s,u,v={},w=[],x=[],y=d(arguments);for(r=y.length-1;0<=r;r--)if(x=y[r],x&&x.length)for(s=x.length-1;0<=s;s--)u=x[s],u&&!v[u.name||u]&&(w.push(u),v[u.name||u]=!0);return w.reverse()},getPathValue:function(s,u){if(!u)return null;var v=s;return"string"==typeof s&&(v=s.split(".")),v.reduce(function(w,x){return w&&"object"==typeof w&&x in w?w[x]:null},u)},setPathValue:function(s,u,v,w){if(u){var x=s;"string"==typeof s&&(x=s.split("."));var y=x.slice(-1)[0];x.reduce(function(z,A){return A===y?z[A]=v:w&&!z[A]&&(z[A]={}),z[A]},u)}},pluck:function(s,u){return b(s,"Array")?s.map(function(v){return m(v,u)}):m(s,u)},cloneObj:q,mergeObj:function(s,u){var v=q(s);return Object.keys(u).forEach(function(w){v[w]=u[w]}),v},indexByProp:function(s,u){var v={};for(var w=s.length-1;0<=w;w--){var x=s[w][u];v[x]=s[w]}return v},indexAllByProp:function(s,u){var v={};for(var w=s.length-1;0<=w;w--){var x=s[w][u];v[x]||(v[x]=[]),v[x].push(s[w])}return v}}})(window.StrandLib=window.StrandLib||{});</script><script>(function(a){a.DomMutable={properties:{mutationTarget:{type:Object,value:function(){return this}},observeSubtree:{type:Boolean,value:!1},observeCharacterData:{type:Boolean,value:!1},observeAttributes:{type:Boolean,value:!1},_observer:{type:Object,value:function(){return new MutationObserver(this._nodesChanged.bind(this))}}},attached:function(){this._observer.observe(this.mutationTarget,{childList:!0,subtree:this.observeSubtree,attributes:this.observeAttributes,characterData:this.observeCharacterData})},detached:function(){this._observer.disconnect()},_nodesChanged:function(b){var c=StrandLib.DataUtils.clone;c(b).forEach(function(d){if(d.addedNodes.length&&this.fire("added",{nodes:c(d.addedNodes)}),d.removedNodes.length){var e=c(d.removedNodes);this.fire("removed",{nodes:e})}0===d.addedNodes.length&&0===d.removedNodes.length&&this.fire("modified",{nodes:[d.target]})},this)}}})(window.StrandTraits=window.StrandTraits||{});</script><script>(function(a){var b={properties:{contentTarget:{type:Object,value:function(){return this}}},getLightDOM:function(){// return Polymer.dom(this.contentTarget.$[this.contentId]).getDistributedNodes();
return Polymer.dom(this.contentTarget).queryDistributedElements("*")}};a.LightDomGettable=b})(window.StrandTraits=window.StrandTraits||{});</script><script>(function(a){var b={properties:{domObject:{type:Object,value:function(){return{}},notify:!0},observeSubtree:{type:Boolean,value:!0},observeCharacterData:{type:Boolean,value:!0},observeAttributes:{type:Boolean,value:!0}},ready:function(){this.async(this._updateDomObject)},_updateDomObject:function(){this.set("domObject",StrandLib.DataUtils.objectifyDistributedNodes(this.getLightDOM())),this.domObjectChanged(this.domObject)},domObjectChanged:function(){},_nodesChanged:function(c){a.DomMutable._nodesChanged.apply(this,[c]),this._updateDomObject()}};a.DomGettable=[a.DomMutable,a.LightDomGettable,b]})(window.StrandTraits=window.StrandTraits||{});</script><script>(function(a){a.Falsifiable={deserialize:function(b,c){switch(c){case Boolean:if(""===b)return!0;try{return JSON.parse(b)}catch(d){return console.warn("falsifiable: couldn`t decode Boolean"),b}break;default:return Polymer.Base.deserialize(b,c);}}}})(window.StrandTraits=window.StrandTraits||{});</script></div><dom-module id="strand-fetch"><template><style>:host{display:none}</style><content id="content"></content></template></dom-module><script>(function(a){var b=StrandLib.DataUtils;a.Fetch=Polymer({is:'strand-fetch',behaviors:[StrandTraits.Refable,StrandTraits.DomGettable,StrandTraits.Falsifiable],properties:{url:{type:String,notify:!0,observer:'_urlChanged'},auto:{type:Boolean,value:function(){return this.async(function(){void 0===this.auto&&(this.auto=!0)}),void 0}},//see https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch
fetchOptions:{type:Object,value:function(){return{mode:'same-origin',credentials:'same-origin',redirect:'follow'}}},data:{type:Object,notify:!0},body:{type:String,observer:'_bodyChanged'}},domObjectChanged:function(c){if(this.auto){var d=b.getPathValue('url.0.inner',c);d&&this.set('url',d)}},_urlChanged:function(){this.url&&this.auto&&this.debounce('action',this.get,200)},_bodyChanged:function(){if(this.auto){var c=b.getPathValue('url.0.inner',domObject);this.url=c,this.url&&this.body&&this.debounce('action',this.post,200)}},_responseHandler:function(c){this.fire('fetch-success',c),c.json().then(function(d){this.set('data',d),this.fire('fetch-data',d)}.bind(this),function(d){this.fire('fetch-parse-error',d)}.bind(this))},_errorHandler:function(c){this.fire('fetch-error',c)},fetch:function(c,d,e){var f={method:d||'GET'};return this.body&&(f.body=this.body),fetch(c||this.url,Object.assign(f,e,this.fetchOptions)).then(this._responseHandler.bind(this),this._errorHandler.bind(this))},get:function(c,d){return this.fetch(c,'GET',d)},post:function(c,d){return this.fetch(c,'POST',d)},put:function(c,d){return this.fetch(c,'PUT',d)},delete:function(c,d){return this.fetch(c,'DELETE',d)}})})(window.Strand=window.Strand||{});</script></body></html>
<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

--><html><head><link rel="import" href="../../bower_components/polymerLegacy/polymer.html"><link rel="import" href="../shared/fonts/fonts.html"><link rel="import" href="../shared/js/colors.html"><link rel="import" href="../shared/js/windownotifier.html"><link rel="import" href="../mm-icon/mm-icon.html"><link rel="import" href="../mm-close-panel/mm-close-panel.html"><link rel="import" href="../mm-list-item/mm-list-item.html"><link rel="import" href="../mm-item-recycler/mm-item-recycler.html"><link rel="import" href="../shared/js/measure.html"></head><body><polymer-element name="mm-dropdown" constructor="MMDropdown" assetpath=""><template><style type="text/css">.button{box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-moz-box-align:center;box-align:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-pack:start;-moz-box-pack:start;box-pack:start;-webkit-justify-content:start;-moz-justify-content:start;-ms-justify-content:start;-o-justify-content:start;justify-content:start;-ms-flex-pack:start;border:1px solid;border-radius:4px 4px 4px 4px;padding:0 10px;cursor:pointer;margin:0;height:29px;width:auto}polyfill-next-selector{content:'.button label, .button'}.button ::content label,.button{font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-weight:700;font-size:13px!important;line-height:28px!important;text-transform:capitalize}polyfill-next-selector{content:'.button label'}::content label{pointer-events:none;white-space:nowrap}polyfill-next-selector{content:'.button mm-icon'}::content mm-icon{display:block;pointer-events:none}polyfill-next-selector{content:'.button mm-icon + label'}::content mm-icon+label{padding-left:7px}.button:focus{outline:0}.button.fit{width:100%}.button.primary{color:#003C71;border-color:#55ADF3;background:#96D4F8}.button.invalid,.button.primary.invalid,.button.secondary.invalid{border-color:#f85252}.button.primary:hover{color:#003C71;background-color:#77BDF5}.button.primary:active{background-image:-webkit-linear-gradient(#5ca1d7,#77BDF5);background-image:linear-gradient(#5ca1d7,#77BDF5);box-shadow:inset 0 5px 1px #5ca1d7}.button.secondary{color:#333;border-color:#CCC;background:#fff;background-image:-webkit-linear-gradient(#fff,#f2f4f8);background-image:linear-gradient(#fff,#f2f4f8)}.button.secondary:hover{color:#333;background-color:#E5E5E5;background-image:none}.button.secondary:active{background-image:-webkit-linear-gradient(#d5d5d5,#E5E5E5);background-image:linear-gradient(#d5d5d5,#E5E5E5);box-shadow:inset 0 5px 1px #d5d5d5}.button.opened.bottom{border-radius:4px 4px 0 0}.button.opened.top{border-radius:0 0 4px 4px}:host([layout=hgroup-left]) .button{border-radius:4px 0 0 4px}:host([layout=hgroup-left]) .button.opened.bottom{border-radius:4px 0 0 0}:host([layout=hgroup-left]) .button.opened.top{border-radius:0 0 0 4px}:host([layout=hgroup-center]){margin-left:-1px}:host([layout=hgroup-center]) .button,:host([layout=hgroup-center]) .button.opened.bottom,:host([layout=hgroup-center]) .button.opened.top{border-radius:0}:host([layout=hgroup-right]){margin-left:-1px}:host([layout=hgroup-right]) .button{border-radius:0 4px 4px 0}:host([layout=hgroup-right]) .button.opened.bottom{border-radius:0 4px 0 0}:host([layout=hgroup-right]) .button.opened.top{border-radius:0 0 4px 0}:host([layout=vgroup-top]) .button,:host([layout=vgroup-center]) .button,:host([layout=vgroup-left]) .button{-webkit-box-pack:center;-moz-box-pack:center;box-pack:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-ms-flex-pack:center}:host([layout=vgroup-top]) .button{border-radius:4px 4px 0 0}:host([layout=vgroup-center]){margin-top:-1px}:host([layout=vgroup-center]) .button{border-radius:0}:host([layout=vgroup-bottom]){margin-top:-1px}:host([layout=vgroup-bottom]) .button{border-radius:0 0 4px 4px}.button{font-weight:400;display:block;position:relative;padding-right:32px}.button label{pointer-events:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-transform:none;display:block;width:100%;font-weight:400}.button #caratIcon{padding:0 10px 0 13px;position:absolute;margin-top:-4px;top:50%;right:0;display:block}.button #caratIcon.closed{-webkit-transform:scaleY(1);-moz-transform:scaleY(1);-ms-transform:scaleY(1);-o-transform:scaleY(1);transform:scaleY(1)}.button #caratIcon.opened{-webkit-transform:scaleY(-1);-moz-transform:scaleY(-1);-ms-transform:scaleY(-1);-o-transform:scaleY(-1);transform:scaleY(-1)}.button mm-icon{pointer-events:none}.button .left-items{display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-moz-box-align:center;box-align:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-ms-flex-align:center;-webkit-box-pack:start;-moz-box-pack:start;box-pack:start;-webkit-justify-content:start;-moz-justify-content:start;-ms-justify-content:start;-o-justify-content:start;justify-content:start;-ms-flex-pack:start;height:100%}.scroll-container{overflow-x:hidden;overflow-y:auto}:host([size=small]) .button{padding:0 26px 0 8px;height:26px}:host([size=small]) .button label{font-size:11px!important;line-height:24px!important}:host([size=small]) .button #caratIcon{padding:0 8px 0 10px}:host([size=small]) ::content>mm-list-item,:host([size=small]) mm-list-item{font-size:11px!important;line-height:13px!important}:host([skinless]) .button{border:none;background:initial;padding:0 20px 0 8px}:host([skinless]) .button label{font-weight:700!important}:host([skinless]) .button:hover,:host([skinless]) .button:active{background:initial;box-shadow:none}:host([skinless]) .button #caratIcon{padding:0 8px 0 4px}:host{position:relative;display:inline-block;vertical-align:middle;font-size:0;line-height:0}:host([disabled]){pointer-events:none;opacity:.5}:host([fitparent]){width:100%}:host([disabled]){pointer-events:none;opacity:.5}::shadow input[type=text]:focus{box-shadow:none}#recycler{height:100%}</style><div class="button secondary {{state}} {{ { bottom:$.closePanel.calcValign == 'BOTTOM', top:$.closePanel.calcValign == 'TOP', fit:fitparent!=null, invalid:error == true } | tokenList }}" id="buttonMain" on-mousedown="{{toggle}}" title="{{displayTitle}}"><div class="left-items"><label id="labelText">{{selectedItem.label || placeholder}}</label></div><mm-icon id="caratIcon" class="{{state}}" type="carat" width="8" height="8" primarycolor="[[SECONDARY_ICON_COLOR]]" shaperendering="auto" optimize="true"></mm-icon></div><mm-close-panel id="closePanel" fitparent="{{fitparent}}" target="{{$.buttonMain}}" offsety="-1" auto="true" mode="dropdown" targetfilter="{{closeFilter}}" state="{{state}}" scope="{{}}"><content id="search" select="mm-input"></content><div id="list" class="scroll-container"><template if="{{!data}}"><div on-tap="{{onSelectItem}}"><content id="items" select="mm-list-item"></content></div></template><template if="{{data}}"><mm-item-recycler id="recycler" itemtemplate="defaultTemplate" on-tap="{{onSelectItem}}" data="{{data}}"><template id="defaultTemplate"><mm-list-item selected?="{{model.selected}}" value="{{model.value}}" title="{{model.label}}">{{model.label}}</mm-list-item></template></mm-item-recycler></template></div></mm-close-panel></template><script>Polymer("mm-dropdown",{ver:"<<version>>",selectedItem:null,STATE_OPENED:"opened",STATE_CLOSED:"closed",LAYOUT_TYPE:"dropdown",SECONDARY_ICON_COLOR:Colors.A2,publish:{value:{value:"",reflect:true},placeholder:"Select",maxItems:0,overflow:"hidden",overflowWidth:0,disabled:{value:false,reflect:true},fitparent:{value:false,reflect:true},data:null,error:false,skinless:false,size:"normal"},created:function(){this.state=this.STATE_CLOSED},ready:function(){if(this.hasAttribute("value")){this.initialValue=true}this.style.webkitTransform=this.style.webkitTransform},attached:function(){WindowNotifier.addInstance(this)},detached:function(){WindowNotifier.removeInstance(this)},domReady:function(){if(!this.fitparent&&!this.skinless){this.btnWidth=this.btnWidth+this.borderWidth}var search=this.$.search.getDistributedNodes();if(search.length){search[0].setAttribute("layout",this.LAYOUT_TYPE)}this.resize()},resize:function(){this.job("resize",this.updateDisplay,0)},updateDisplay:function(){var actualMax,item,panelWidth;if(this.maxItems){actualMax=Math.min(this.items.length,this.maxItems);this.$.list.style.height=Math.min(this.itemHeight*actualMax,window.innerHeight)+"px";if(this.data){this.$.list.querySelector("#recycler").resizeViewport()}}if(this.overflow==="visible"){if(this.overflowWidth){panelWidth=this.overflowWidth+"px"}else if(this.items.length>0&&this.scrollbarWidth||this.data){item=this.items[0];if(this.data){var recycler=this.$.list.querySelector("#recycler");item=recycler._physicalPanels[0].items[0]}var borderWidth=Measure.getBorderWidth(this.$.closePanel.$.container);panelWidth=Math.ceil(item.textBounds.width+this.scrollbarWidth+item.paddingWidth+borderWidth)+"px"}else{panelWidth="auto"}this.$.closePanel.style.minWidth=this.btnWidth+"px"}else{panelWidth=this.btnWidth+"px"}this.$.closePanel.style.width=panelWidth;this.updateTitle()},set btnWidth(i){this.$.buttonMain.style.width=i+"px"},get btnWidth(){if(this.$)return Math.ceil(parseFloat(Measure.getComputedStyle(this.$.buttonMain).width))},get btnPaddingWidth(){return Measure.getPaddingWidth(this.$.buttonMain)},get borderWidth(){return Measure.getBorderWidth(this.$.buttonMain)},get scrollbarWidth(){return Measure.getScrollbarWidth(this)},get itemHeight(){if(this.data){return this.$.list.querySelector("#recycler").itemHeight}else if(this.items.length){return this.items[0].offsetHeight}return 0},get items(){return this.data?this.data:Array.prototype.slice.call(this.$.items.getDistributedNodes())},open:function(e){this.state=this.STATE_OPENED},close:function(e){this.state=this.STATE_CLOSED},reset:function(){this.value=""},closeFilter:function(instance,e){if(Array.prototype.slice.call(e.path).indexOf(this)>-1){e.stopImmediatePropagation()}else{instance.closeHandler()}},toggle:function(e){if(this.state===this.STATE_OPENED){this.close()}else{this.resize();this.open()}},onSelectItem:function(e,detail,sender){if(e.target!==sender){this.selectedFlag=true;this.selectedItem=this.data?e.target.templateInstance.model.model:e.target;this.close();e.target.style.webkitTransform=e.target.style.webkitTransform}},selectedItemChanged:function(oldItem,newItem){if(oldItem){oldItem.selected=false}if(newItem){newItem.selected=true;this.value=newItem.value;this.fire("selected",{item:newItem,index:this.items.indexOf(newItem),value:newItem.value,selected:newItem.selected})}this.async(this.updateTitle)},dataChanged:function(){this.resize();this.selectItemByValue(this.value)},valueChanged:function(oldValue,newValue){if(this.initialValue){this.initialValue=false}else{this.fire("changed",{value:this.value});this.updateModel()}if(!this.selectedFlag){this.selectItemByValue(this.value)}this.selectedFlag=false},selectItemByValue:function(value){var selectedIndex=this.items.map(this.getItemValue).indexOf(String(value));this.selectedItem=this.items[selectedIndex]},getItemValue:function(item){return String(item.value)},placeholderChanged:function(oldPlace,newPlace){this.async(this.updateTitle)},updateTitle:function(){var textBounds=Measure.getTextBounds(this.$.labelText),availableTxtArea=this.btnWidth+this.borderWidth-this.btnPaddingWidth;if(textBounds.width>=availableTxtArea){this.displayTitle=this.selectedItem?this.selectedItem.label:this.placeholder}else{this.displayTitle=""}},bindModel:function(model,property){this.model=model;this.property=property},updateModel:function(){if(this.model&&this.property){if(this.model.set){var o={};o[this.property]=this.value;this.model.set(o)}else{this.model[this.property]=this.value}}}});</script></polymer-element></body></html>
<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

--><html><head><link rel="import" href="../shared/js/windownotifier.html"><link rel="import" href="../shared/js/rectangle.html"><link rel="import" href="../../../polymer/polymer.html"><link rel="import" href="../mm-stack-manager/mm-stack-manager.html"><link rel="import" href="../mm-close-manager/mm-close-manager.html"><link rel="import" href="../mm-icon/mm-icon.html"></head><body><polymer-element name="mm-close-panel" attributes="state target align valign calcAlign calcValign offsetX offsetY mode auto targetFilter scope fitparent stackType" constructor="MMClosePanel" assetpath=""><template><style type="text/css">:host{position:fixed;clip:rect(0,0,0,0);line-height:0;font-size:0}:host([fitparent]){width:100%}.cp-container{box-sizing:border-box;position:relative;background:#fff;border:1px solid #CCC;overflow:hidden}.cp-container ._mm_close_icon{display:none}.cp-container._mm_popover,.cp-container._mm_tooltip{border-radius:4px 4px 4px 4px;box-shadow:0 6px 12px 0 rgba(0,0,0,.18)}.cp-container._mm_popover._mm_bottom,.cp-container._mm_tooltip._mm_bottom{margin-top:10px}.cp-container._mm_popover._mm_top,.cp-container._mm_tooltip._mm_top{margin-bottom:10px}.cp-container._mm_popover._mm_left,.cp-container._mm_tooltip._mm_left{margin-right:10px}.cp-container._mm_popover._mm_right,.cp-container._mm_tooltip._mm_right{margin-left:10px}.cp-container._mm_dropdown._mm_bottom{border-radius:0 0 4px 4px;box-shadow:0 6px 12px 0 rgba(0,0,0,.18)}.cp-container._mm_dropdown._mm_top{border-radius:4px 4px 0 0;box-shadow:0 0 12px 0 rgba(0,0,0,.18)}.cp-container._mm_tooltip{background:#191919;border:none;padding:10px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-family:Arimo,sans-serif;font-size:12px;line-height:15px;color:#fff}.cp-container._mm_tooltip polyfill-next-selector{content:'a'}.cp-container._mm_tooltip ::content a{color:#fff}.cp-container._mm_tooltip ._mm_close_icon{position:absolute;display:none;cursor:pointer}.cp-container._mm_tooltip ._mm_close_icon._mm_visible{display:block}.cp-container._mm_tooltip._mm_close{padding:16px}.cp-container._mm_tooltip._mm_close ._mm_close_icon{top:8px;right:8px}._mm_arrow._mm_popover._mm_bottom:after,._mm_arrow._mm_popover._mm_bottom:before,._mm_arrow._mm_popover._mm_top:after,._mm_arrow._mm_popover._mm_top:before,._mm_arrow._mm_popover._mm_bottom:after,._mm_arrow._mm_popover._mm_bottom:before,._mm_arrow._mm_popover._mm_left:after,._mm_arrow._mm_popover._mm_left:before,._mm_arrow._mm_popover._mm_right:after,._mm_arrow._mm_popover._mm_right:before,._mm_arrow._mm_tooltip._mm_bottom:after,._mm_arrow._mm_tooltip._mm_bottom:before,._mm_arrow._mm_tooltip._mm_top:after,._mm_arrow._mm_tooltip._mm_top:before,._mm_arrow._mm_tooltip._mm_bottom:after,._mm_arrow._mm_tooltip._mm_bottom:before,._mm_arrow._mm_tooltip._mm_left:after,._mm_arrow._mm_tooltip._mm_left:before,._mm_arrow._mm_tooltip._mm_right:after,._mm_arrow._mm_tooltip._mm_right:before{right:auto;bottom:auto;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}._mm_arrow._mm_popover._mm_bottom:after,._mm_arrow._mm_popover._mm_bottom:before,._mm_arrow._mm_tooltip._mm_bottom:after,._mm_arrow._mm_tooltip._mm_bottom:before{top:auto;left:50%}._mm_arrow._mm_popover._mm_bottom._mm_right,._mm_arrow._mm_popover._mm_bottom._mm_left,._mm_arrow._mm_tooltip._mm_bottom._mm_right,._mm_arrow._mm_tooltip._mm_bottom._mm_left{display:none}._mm_arrow._mm_popover._mm_bottom:after,._mm_arrow._mm_tooltip._mm_bottom:after{top:-9px;border-color:rgba(255,255,255,0);border-bottom-color:#fff;border-width:10px;margin-left:-10px}._mm_arrow._mm_popover._mm_bottom:before,._mm_arrow._mm_tooltip._mm_bottom:before{top:-11px;border-color:rgba(204,204,204,0);border-bottom-color:#CCC;border-width:11px;margin-left:-11px}._mm_arrow._mm_popover._mm_top:after,._mm_arrow._mm_popover._mm_top:before,._mm_arrow._mm_tooltip._mm_top:after,._mm_arrow._mm_tooltip._mm_top:before{top:auto;left:50%}._mm_arrow._mm_popover._mm_top._mm_right,._mm_arrow._mm_popover._mm_top._mm_left,._mm_arrow._mm_tooltip._mm_top._mm_right,._mm_arrow._mm_tooltip._mm_top._mm_left{display:none}._mm_arrow._mm_popover._mm_top:after,._mm_arrow._mm_tooltip._mm_top:after{bottom:-9px;border-color:rgba(255,255,255,0);border-top-color:#fff;border-width:10px;margin-left:-10px}._mm_arrow._mm_popover._mm_top:before,._mm_arrow._mm_tooltip._mm_top:before{bottom:-11px;border-color:rgba(204,204,204,0);border-top-color:#CCC;border-width:11px;margin-left:-11px}._mm_arrow._mm_popover._mm_left:after,._mm_arrow._mm_popover._mm_left:before,._mm_arrow._mm_tooltip._mm_left:after,._mm_arrow._mm_tooltip._mm_left:before{top:50%;left:auto}._mm_arrow._mm_popover._mm_left:after,._mm_arrow._mm_tooltip._mm_left:after{border-color:rgba(255,255,255,0);border-left-color:#fff;border-width:10px;margin-left:-10px;margin-top:-10px}._mm_arrow._mm_popover._mm_left:before,._mm_arrow._mm_tooltip._mm_left:before{border-color:rgba(204,204,204,0);border-left-color:#CCC;border-width:11px;margin-left:-11px;margin-top:-11px}._mm_arrow._mm_popover._mm_bottom._mm_left:after,._mm_arrow._mm_popover._mm_top._mm_left:after,._mm_arrow._mm_tooltip._mm_bottom._mm_left:after,._mm_arrow._mm_tooltip._mm_top._mm_left:after{right:-9px}._mm_arrow._mm_popover._mm_bottom._mm_left:before,._mm_arrow._mm_popover._mm_top._mm_left:before,._mm_arrow._mm_tooltip._mm_bottom._mm_left:before,._mm_arrow._mm_tooltip._mm_top._mm_left:before{right:-11px}._mm_arrow._mm_popover._mm_center._mm_left:after,._mm_arrow._mm_tooltip._mm_center._mm_left:after{right:-9px}._mm_arrow._mm_popover._mm_center._mm_left:before,._mm_arrow._mm_tooltip._mm_center._mm_left:before{right:-11px}._mm_arrow._mm_popover._mm_right:after,._mm_arrow._mm_popover._mm_right:before,._mm_arrow._mm_tooltip._mm_right:after,._mm_arrow._mm_tooltip._mm_right:before{top:50%;left:auto}._mm_arrow._mm_popover._mm_right:after,._mm_arrow._mm_tooltip._mm_right:after{border-color:rgba(255,255,255,0);border-right-color:#fff;border-width:10px;margin-right:-10px;margin-top:-10px}._mm_arrow._mm_popover._mm_right:before,._mm_arrow._mm_tooltip._mm_right:before{border-color:rgba(204,204,204,0);border-right-color:#CCC;border-width:11px;margin-right:-11px;margin-top:-11px}._mm_arrow._mm_popover._mm_bottom._mm_right:after,._mm_arrow._mm_popover._mm_top._mm_right:after,._mm_arrow._mm_tooltip._mm_bottom._mm_right:after,._mm_arrow._mm_tooltip._mm_top._mm_right:after{left:1px}._mm_arrow._mm_popover._mm_bottom._mm_right:before,._mm_arrow._mm_popover._mm_top._mm_right:before,._mm_arrow._mm_tooltip._mm_bottom._mm_right:before,._mm_arrow._mm_tooltip._mm_top._mm_right:before{left:0}._mm_arrow._mm_popover._mm_center._mm_right:after,._mm_arrow._mm_tooltip._mm_center._mm_right:after{left:-9px}._mm_arrow._mm_popover._mm_center._mm_right:before,._mm_arrow._mm_tooltip._mm_center._mm_right:before{left:-11px}._mm_arrow._mm_tooltip._mm_bottom:before,._mm_arrow._mm_tooltip._mm_top:before,._mm_arrow._mm_tooltip._mm_bottom:before,._mm_arrow._mm_tooltip._mm_left:before,._mm_arrow._mm_tooltip._mm_right:before{border:none}._mm_arrow._mm_tooltip._mm_bottom:after{top:-2px;border-color:rgba(255,255,255,0);border-bottom-color:#191919;border-width:6px;margin-left:-6px}._mm_arrow._mm_tooltip._mm_bottom:before{top:0;border-width:0;margin-left:0}._mm_arrow._mm_tooltip._mm_top:after{bottom:-2px;border-color:rgba(255,255,255,0);border-top-color:#191919;border-width:6px;margin-left:-6px}._mm_arrow._mm_tooltip._mm_top:before{bottom:0;border-width:0;margin-left:0}._mm_arrow._mm_tooltip._mm_left:after{border-color:rgba(255,255,255,0);border-left-color:#191919;border-width:6px;margin-left:-6px;margin-top:-6px}._mm_arrow._mm_tooltip._mm_left:before{border-width:0;margin-left:0;margin-top:0}._mm_arrow._mm_tooltip._mm_bottom._mm_left:after,._mm_arrow._mm_tooltip._mm_top._mm_left:after{right:-10px}._mm_arrow._mm_tooltip._mm_bottom._mm_left:before,._mm_arrow._mm_tooltip._mm_top._mm_left:before{right:auto}._mm_arrow._mm_tooltip._mm_center._mm_left:after{right:-2px}._mm_arrow._mm_tooltip._mm_center._mm_left:before{right:auto}._mm_arrow._mm_tooltip._mm_right:after{border-color:rgba(255,255,255,0);border-right-color:#191919;border-width:6px;margin-right:-6px;margin-top:-6px}._mm_arrow._mm_tooltip._mm_right:before{border-width:0;margin-right:0;margin-top:0}._mm_arrow._mm_tooltip._mm_bottom._mm_right:after,._mm_arrow._mm_tooltip._mm_top._mm_right:after{left:0}._mm_arrow._mm_tooltip._mm_bottom._mm_right:before,._mm_arrow._mm_tooltip._mm_top._mm_right:before{left:auto}._mm_arrow._mm_tooltip._mm_center._mm_right:after{left:-2px}._mm_arrow._mm_tooltip._mm_center._mm_right:before{left:auto}</style><mm-stack-manager id="stack" type="{{stackType}}" target="{{}}"></mm-stack-manager><mm-close-manager target="{{target}}" on-close="{{close}}" targetfilter="{{targetFilter}}" scope="{{scope}}"></mm-close-manager><div id="container" class="cp-container {{ {_mm_dropdown:mode == 'dropdown', _mm_tooltip:mode == 'tooltip', _mm_popover:mode == 'popover', _mm_close:auto == false, _mm_bottom:calcValign == 'BOTTOM', _mm_top:calcValign == 'TOP', _mm_center:calcValign=='VCENTER'} | tokenList }} {{ {_mm_left:calcAlign == 'LEFT', _mm_right:calcAlign == 'RIGHT', _mm_center:calcAlign=='CENTER'} | tokenList }}"><content id="content"></content><mm-icon id="closeIcon" type="delete" class="_mm_close_icon {{ {_mm_visible:auto == false} | tokenList }}" width="8" height="8" primarycolor="[[CLOSE_ICON_COLOR]]" hovercolor="[[CLOSE_ICON_HOVER]]"></mm-icon></div><div class="_mm_arrow {{ {_mm_dropdown:mode == 'dropdown', _mm_tooltip:mode == 'tooltip', _mm_popover:mode == 'popover', _mm_bottom:calcValign == 'BOTTOM', _mm_top:calcValign == 'TOP', _mm_center:calcValign=='VCENTER'} | tokenList }} {{ {_mm_left:calcAlign == 'LEFT', _mm_right:calcAlign == 'RIGHT', _mm_center:calcAlign=='CENTER'} | tokenList }}"></div></template><script>(function(){function _ancestry(node,target){if(node===target){return true}else if(node.children&&node.children.length||node.nodeName.toLowerCase()==="content"&&node.getDistributedNodes().length){var o=node.children.length?node.children:node.getDistributedNodes();var sum=false;for(var i=0;i<o.length;i++){sum=sum||_ancestry(o[i],target);if(sum)break}return sum}return false}function _ancestorCache(node,target){var cache=node._cache=node._cache||{};if(cache[target]===null||cache[target]===undefined){return cache[target]=_ancestry(node,target)}else{return cache[target]}}function _disableScroll(scope){var handle=_handler.bind(scope);window.addEventListener("DOMMouseScroll",handle,false);window.onmousewheel=document.onmousewheel=handle;document.onkeydown=handle}function _enableScroll(scope){window.removeEventListener("DOMMouseScroll",_handler,false);window.onmousewheel=document.onmousewheel=document.onkeydown=null}function _handler(e){var allow=false;allow=_ancestorCache(this,wrap(e.target));if(!allow){if(!e.keyCode||[37,38,39,40].indexOf(e.keyCode)!==-1){e.preventDefault();e.returnValue=false}}}Polymer("mm-close-panel",{ver:"<<version>>",STATE_OPENED:"opened",STATE_CLOSED:"closed",MODE_POPOVER:"popover",MODE_DROPDOWN:"dropdown",MODE_TOOLTIP:"tooltip",CLOSE_ICON_COLOR:Colors.A4,CLOSE_ICON_HOVER:Colors.F0,publish:{mode:{value:"popover",reflect:true},auto:true,state:"closed",offsetX:0,offsetY:0,stackType:"ui"},attached:function(){if(!this.target){this.target=this.parentNode}if(!this.align){this.align=this.isRelative?"center":"left"}if(!this.valign){this.valign="bottom"}WindowNotifier.addInstance(this)},detached:function(){WindowNotifier.removeInstance(this)},observe:{"align valign offsetX offsetY targetTop targetLeft target width height auto":"shimPositionJobHandler"},_filterValign:function(v){if(v.toLowerCase()==="center"){return"VCENTER"}return v.toUpperCase()},resize:function(){this.job("resize",this.positionHandler,0)},scroll:function(){this.job("scroll",this.positionHandler,0)},shimPositionJobHandler:function(){this.job("resize",this.positionHandler,0)},positionHandler:function(oldValue,newValue){if(!this.valign||!this.align)return;var tm=this.targetMetrics,valign=ovalign=Rectangle.SIDE[this._filterValign(this.valign)],align=oalign=Rectangle.SIDE[this.align.toUpperCase()],winRect=new Rectangle(0,0,window.innerWidth,window.innerHeight),offsetRect=new Rectangle(-this.offsetX,-this.offsetY),panelRect=this.metrics,targetRect=this.targetMetrics,overlap,mode=this.isRelative?"position":"align",projectionRect;projectionRect=panelRect.clone();projectionRect.positionRelative(targetRect,valign);if(this.isRelative){projectionRect.positionRelative(targetRect,align)}else{projectionRect.alignRelative(targetRect,align)}overlap=projectionRect.outside(winRect);projectionRect=null;align=Rectangle.fixBits(align,overlap,Rectangle.SIDE.LEFT|Rectangle.SIDE.RIGHT,mode);valign=Rectangle.fixBits(valign,overlap,Rectangle.SIDE.TOP|Rectangle.SIDE.BOTTOM,mode);this.calcAlign=Rectangle.SIDE.data[align];this.calcValign=Rectangle.SIDE.data[valign];align!==oalign?offsetRect.x=-offsetRect.x:offsetRect.x;valign!==ovalign?offsetRect.y=-offsetRect.y:offsetRect.y;targetRect.subtract(offsetRect);panelRect.positionRelative(targetRect,valign);if(this.isRelative){panelRect.positionRelative(targetRect,align)}else{panelRect.alignRelative(targetRect,align)}panelRect.toCSS(this)},get targetMetrics(){return this.target&&Rectangle.fromElement(this.target,this)},get targetTop(){return this.target&&this.targetMetrics.top},get targetLeft(){return this.target&&this.targetMetrics.left},get width(){return this.metrics.width},get height(){return this.metrics.height},get metrics(){return Rectangle.fromElement(this)},get isRelative(){return this.mode===this.MODE_POPOVER||this.mode===this.MODE_TOOLTIP},modeChanged:function(oldMode,newMode){if(newMode===this.MODE_DROPDOWN){this.classList.add("bottom")}else{this.classList.remove("bottom")}},stateChanged:function(oldState,newState){if(newState===this.STATE_OPENED){this.style.setProperty("clip","auto")}else{this.style.setProperty("clip","rect(0,0,0,0)")}},open:function(){this.state=this.STATE_OPENED},close:function(){this.state=this.STATE_CLOSED},toggle:function(){if(this.state===this.STATE_OPENED){this.close()}else{this.open()}}})})();</script></polymer-element></body></html>
<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

--><html><head><link rel="import" href="../../../polymerLegacy/polymer.html"><link rel="import" href="../mm-item-recycler/mm-item-recycler.html"><link rel="import" href="../mm-grid-column/mm-grid-column.html"><link rel="import" href="../mm-grid-item/mm-grid-item.html"><link rel="import" href="../mm-checkbox/mm-checkbox.html"><link rel="import" href="../mm-icon/mm-icon.html"><link rel="import" href="../mm-loader/mm-loader.html"></head><body><polymer-element name="mm-grid" attributes="recycle" on-column-sort="{{onColumnSort}}" on-column-resize-start="{{onColumnResizeStart}}" on-column-resize="{{onColumnResize}}" on-column-resize-end="{{onColumnResizeEnd}}" on-item-selected="{{onItemSelected}}" assetpath=""><template><style type="text/css">polyfill-next-selector{content:':host ._mm_column'}._mm_column{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 10px;vertical-align:middle;box-sizing:border-box;float:left}._mm_column.right{text-align:right}._mm_column.checkbox,._mm_column.toggle{box-sizing:content-box;margin:auto 0;padding:0 5px}._mm_column.checkbox:first-of-type,._mm_column.toggle:first-of-type{padding-left:15px}._mm_column.checkbox{width:18px}._mm_column.toggle{width:10px}._mm_column.toggle mm-icon{cursor:pointer;-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-ms-transform:rotate(-90deg);-o-transform:rotate(-90deg);transform:rotate(-90deg)}._mm_column.toggle.expanded mm-icon{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}:host{display:block;position:relative;overflow:hidden;min-height:300px}:host([recycle=false]){min-height:0}:host([recycle=false]) #viewport{position:static}#header,#footer{display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;position:absolute;min-width:100%;background:#e0e0e0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-shadow:0 0 5px 0 #7F7F7F}#header{top:0}#footer{bottom:0}#viewport{-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);position:absolute;width:100%;top:0;bottom:0;overflow:auto;background:#fff}#separator{display:none;-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);-o-transform:translateZ(0);transform:translateZ(0);position:absolute;top:0;height:100%;padding:0 50px;margin-left:-50px;cursor:col-resize}#separator:after{display:block;content:"";width:2px;height:100%;background-color:rgba(0,0,0,.3)}#separator.visible{display:block}#loader{position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;width:125px;height:28px}#columnContainer{display:-webkit-box;display:-moz-box;display:box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;-webkit-flex:1;-moz-flex:1;-ms-flex:1;flex:1}</style><mm-item-recycler id="viewport" viewportwidth="{{viewportWidth}}" itemtemplate="{{itemTemplate}}" data="{{data}}" scope="{{}}" index="{{index}}" on-scroll="{{onScroll}}"><content select=":not(mm-grid-column)"></content><template id="defaultTemplate"><mm-grid-item model="{{model}}" scope="{{scope}}"></mm-grid-item></template><div id="header"><template if="{{selectable}}"><div class="_mm_column checkbox"><mm-checkbox id="selectAll" on-tap="{{selectAll}}" state="{{selectAllState}}"></mm-checkbox></div></template><template if="{{expandable}}"><div class="_mm_column toggle {{ { expanded: expanded } | tokenList }}"><template if="{{expandable == 'all'}}"><mm-icon width="10" height="10" type="expand-all" on-tap="{{expandAll}}"></mm-icon></template></div></template><div id="columnContainer"><content id="columns" select="mm-grid-column"></content><template if="{{!columnsExist}}"><template repeat="{{column in columns}}"><mm-grid-column width="{{column.width}}" label="{{column.label}}" field="{{column.field}}" sort="{{column.sort}}" resize?="{{column.resize}}" info="{{column.info}}" align="{{column.align}}"></mm-grid-column></template></template></div></div></mm-item-recycler><template if="{{isLoading}}"><mm-loader id="loader"><label>Loading...</label></mm-loader></template><div id="separator"></div></template><script>(function(){window.addEventListener("mousewheel",function(){});if(document.documentElement.style.transform!==undefined){function setTransform(element,string,value){element.style.transform=string;element._transformValue=value}}else{function setTransform(element,string,value){element.style.webkitTransform=string;element._transformValue=value}}function arrayToMap(arr,key){return arr.reduce(function(map,obj){map[obj[key]]=obj;return map},{})}Polymer("mm-grid",{ver:"<<version>>",publish:{data:null,columns:null,index:null,itemTemplate:null,viewportWidth:0,selectable:false,expandable:false,sortField:"",sortOrder:1,isLoading:false,recycle:"true"},expanded:false,observe:{"sortField sortOrder":"onSortChanged"},ready:function(){if(typeof this.itemTemplate==="string"){this.itemTemplate=this.querySelector("#"+this.itemTemplate)}this.itemTemplate=this.itemTemplate||this.$.defaultTemplate},recycleChanged:function(oldVal,newVal){if(newVal==="false"){if(this.$.viewport.data){this.resizeViewport()}}},initializeColumns:function(){if(this.$.columns.getDistributedNodes().length>0){this.columnsExist=true;this.columns=Array.prototype.slice.call(this.$.columns.getDistributedNodes());this.columnsMap=arrayToMap(this.columns,"field");var item=this.itemTemplate.createInstance(this);this.columnOverrideMap=this.columns.reduce(function(map,column){map[column.field]=item.querySelector('[field="'+column.field+'"]')!==null;return map},{})}},resizeViewport:function(){this.$.viewport.resizeViewport()},columnsChanged:function(){this.columnsMap=arrayToMap(this.columns,"field")},setInitialColumnWidth:function(){var setInitialWidth=this.columns.every(function(column){return column.width===null||column.width===undefined});if(setInitialWidth){var initialWidth=100/this.columns.length;this.columns.forEach(function(column){column.width=initialWidth+"%"})}},domReady:function(){this.$.viewport.$.list.style.paddingTop=this.$.header.offsetHeight+"px";this.initializeColumns();this.setInitialColumnWidth()},onScroll:function(e){setTransform(this.$.header,"translate3d(0, "+e.target.scrollTop+"px, 0)",e.target.scrollTop)},onItemSelected:function(e,d,sender){var selected=this.selected,state="unchecked";if(selected.length>0){state="partial"}if(selected.length===this.data.length){state="checked"}this.selectAllState=state},selectAll:function(e,d,sender){this.data.forEach(function(item){item.selected=sender.checked})},get selected(){return this.data&&this.data.filter(function(item){return item.selected})},onColumnResizeStart:function(e){this._columnOffset=e.detail.val},onColumnResize:function(e){var x=this._columnOffset+e.detail.val-this.$.viewport.scrollLeft;this.$.separator.style.left=x+"px";this.showSeparator()},showSeparator:function(){this.$.separator.classList.add("visible");document.body.style.cursor="col-resize"},hideSeparator:function(){this.$.separator.classList.remove("visible");document.body.style.cursor=""},onColumnResizeEnd:function(e){this.resizeColumns(e.detail.field,e.detail.val);this.hideSeparator()},resizeColumns:function(field,val){this.columns.forEach(function(column){if(column.width.indexOf("%")!==-1){column.width=column.offsetWidth+"px"}});if(!this.viewportWidth){this.viewportWidth=this.$.viewport.$.list.offsetWidth}this.viewportWidth+=val},onSortChanged:function(){this.sortBy(this.sortField,this.sortOrder)},onColumnSort:function(e){this.sortField=e.detail.field;this.sortOrder=e.detail.val},sortBy:function(field,order){this.columns.forEach(function(column){if(column.sortField===field){column.sortOrder=order||column.SORT_ASCENDING}else{column.sortOrder=column.SORT_DEFAULT}})},expandAll:function(e,d,sender){this.expanded=!this.expanded;this.$.viewport.inferDefaultHeightFromNextResize(this.expanded);this.data.forEach(function(item){item.expanded=this.expanded}.bind(this))}})})();</script></polymer-element></body></html>
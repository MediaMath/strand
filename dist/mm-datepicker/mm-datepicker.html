<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

--><html><head><link rel="import" href="../../bower_components/polymerLegacy/polymer.html"><link rel="import" href="../mm-calendar/mm-calendar.html"><link rel="import" href="../mm-header/mm-header.html"><link rel="import" href="../mm-input/mm-input.html"><link rel="import" href="../mm-input-mask/mm-input-mask.html"><link rel="import" href="../mm-checkbox/mm-checkbox.html"><link rel="import" href="../mm-footer/mm-footer.html"><link rel="import" href="../mm-button/mm-button.html"><link rel="import" href="../mm-action/mm-action.html"><link rel="import" href="../mm-dropdown/mm-dropdown.html"><link rel="import" href="../mm-list-item/mm-list-item.html"><link rel="import" href="../mm-group/mm-group.html"><link rel="import" href="../mm-close-panel/mm-close-panel.html"><link rel="import" href="../shared/js/measure.html"><link rel="import" href="../shared/js/datautils.html"><link rel="import" href="../shared/js/moment.html"><link rel="import" href="../shared/js/momentrange.html"></head><body><polymer-element name="mm-datepicker" attributes="start end align valign target" constructor="MMDatePicker" assetpath=""><template><style type="text/css">:host{position:relative;display:inline-block;vertical-align:middle;font-size:0;line-height:0}:host::after{clear:both;content:"";display:table}._mm-start,._mm-end{box-sizing:border-box;background:#fff;position:relative;float:left;width:212px}._mm-start mm-calendar,._mm-end mm-calendar{padding:5px 12px 12px 12px}._mm-start .input-top,._mm-start .input-bottom,._mm-end .input-top,._mm-end .input-bottom{box-sizing:border-box;width:100%;padding:15px}._mm-start .input-bottom,._mm-end .input-bottom{padding-top:0}._mm-start .input-top mm-header,._mm-start .input-top mm-input,._mm-start .input-top mm-checkbox,._mm-end .input-top mm-header,._mm-end .input-top mm-input,._mm-end .input-top mm-checkbox{display:block;margin-bottom:10px}._mm-start .input-top mm-input:last-child,._mm-end .input-top mm-input:last-child{margin:0}._mm-end .vert-stroke{position:absolute;width:0;top:15px;bottom:15px;border-left:1px solid #E5E5E5}.range-presets{box-sizing:border-box;background:#fff;width:100%;padding:15px}.range-presets:first-of-type{padding-bottom:0}.range-presets:last-of-type{padding-top:0;clear:left}mm-footer{clear:left}</style><mm-close-panel id="closePanel" valign="{{valign}}" align="{{align}}" targetfilter="{{closeFilter}}" scope="{{}}" target="{{target}}" state="{{state}}"><template if="{{useRange}}"><div class="range-presets"><mm-dropdown id="rangeDropdown" placeholder="{{rangeDescription}}" maxitems="{{ranges.presets.length > ranges.max ? ranges.max : ranges.presets.length}}" fitparent="" value="{{rangeValue}}" data="{{_rangePresets}}"></mm-dropdown></div></template><div class="_mm-start"><div class="input-top"><mm-header class="header" size="normal">{{startLabel}}</mm-header><mm-checkbox id="startCheckbox" style="display:{{ startEnabledLabel | displayItem }};" checked="{{startEnabled}}" disabled?="{{!startUserEnabled}}"><label>{{startEnabledLabel}}</label></mm-checkbox><mm-input-mask id="startDate" icon="calendar" fitparent="" value="{{startDate}}" disabled?="{{startEnabled}}" placeholder="MM/DD/YYYY"><group rule="range" restrict="numeric" size="2" autofill="0"></group><sep chars="/"></sep><group rule="range" restrict="numeric" size="2" autofill="0"></group><sep chars="/"></sep><group rule="range" restrict="numeric" size="4"></group></mm-input-mask></div><mm-calendar id="startCalendar" date="{{startDate | calendarFilter}}" pairdate="{{endDate | calendarFilter}}" disablepast="{{allowedStart}}" disablefuture="{{endDate | calendarFilter}}" disabled?="{{startEnabled}}" on-calendar-select="{{handleTap}}"></mm-calendar><template if="{{useTime}}"><div class="input-bottom"><mm-group><mm-input-mask id="startTime" icon="clock" value="{{startTime}}" width="119" disabled?="{{startEnabled}}" on-keydown="{{keyHandler}}"><group rule="hour12" restrict="numeric" size="2" autofill="0"></group><sep chars=":"></sep><group rule="minutes" restrict="numeric" size="2" autofill="0"></group></mm-input-mask><mm-dropdown id="startPeriod" value="{{startTimePeriod}}" fitparent="" style="width:64px;" disabled?="{{startEnabled}}"><mm-list-item value="am">AM</mm-list-item><mm-list-item value="pm">PM</mm-list-item></mm-dropdown></mm-group></div></template></div><template if="{{dual}}"><div class="_mm-end"><div class="vert-stroke"></div><div class="input-top"><mm-header class="header" size="normal">{{endLabel}}</mm-header><mm-checkbox id="endCheckbox" style="display:{{ endEnabledLabel | displayItem }};" checked="{{endEnabled}}" disabled?="{{!endUserEnabled}}"><label>{{endEnabledLabel}}</label></mm-checkbox><mm-input-mask id="endDate" icon="calendar" fitparent="" value="{{endDate}}" disabled?="{{endEnabled}}" placeholder="MM/DD/YYYY"><group rule="range" size="2" restrict="numeric" autofill="0"></group><sep chars="/"></sep><group rule="range" size="2" restrict="numeric" autofill="0"></group><sep chars="/"></sep><group rule="range" restrict="numeric" size="4"></group></mm-input-mask></div><mm-calendar id="endCalendar" date="{{endDate | calendarFilter }}" pairdate="{{startDate | calendarFilter}}" disablepast="{{startDate | calendarFilter}}" disablefuture="{{allowedEnd}}" disabled?="{{endEnabled}}" on-calendar-select="{{handleTap}}"></mm-calendar><template if="{{useTime}}"><div class="input-bottom"><mm-group><mm-input-mask id="endTime" icon="clock" value="{{endTime}}" width="119" disabled?="{{endEnabled}}" on-keydown="{{keyHandler}}"><group rule="hour12" restrict="numeric" size="2" autofill="0"></group><sep chars=":"></sep><group rule="minutes" restrict="numeric" size="2" autofill="0"></group></mm-input-mask><mm-dropdown id="endPeriod" value="{{endTimePeriod}}" fitparent="" style="width:64px;" disabled?="{{endEnabled}}"><mm-list-item value="am">AM</mm-list-item><mm-list-item value="pm">PM</mm-list-item></mm-dropdown></mm-group></div></template></div></template><template if="{{useTimezone}}"><div class="range-presets"><mm-dropdown id="timezoneDropdown" placeholder="{{timezoneDescription}}" maxitems="{{timezones.length > 10 ? 10 : timezones.length}}" fitparent="" value="{{timezone}}" data="{{_timezones}}"><mm-input id="timezoneSearch" search="" clear="" value="{{timezoneSearch}}"></mm-input></mm-dropdown></div></template><template if="{{useCommit}}"><mm-footer id="footer" fitparent="true" message="{{duration}}" unresolved=""><mm-action underline="true" on-click="{{closeLinkHandler}}"><label>{{closeLabel}}</label></mm-action><mm-button on-click="{{save}}" disabled?="{{!datesValid}}"><label>{{saveLabel}}</label></mm-button></mm-footer></template></mm-close-panel></template><script>(function(){function _undef(a){return a!==null&&a!==undefined&&a!==""}Polymer("mm-datepicker",{ver:"<<version>>",STATE_OPENED:"opened",STATE_CLOSED:"closed",publish:{useTimezone:true,useRange:true,useTime:true,useCommit:true,useDuration:true,resetOnClose:true,dual:true,dateFormat:"MM/DD/YYYY",timeFormat:"hh:mm a",rangeValue:"",rangePresets:null,rangeDescription:"Select a Predefined Date Range",timezoneDescription:"Select a Timezone",timezones:null,start:null,startEnabled:false,startUserEnabled:true,allowedStart:null,startLabel:"start",startEnabledLabel:null,startDate:null,startTime:null,startTimePeriod:"am",end:null,endEnabled:false,endUserEnabled:true,allowedEnd:null,endLabel:"end",endEnabledLabel:null,endDate:null,endTime:null,endTimePeriod:"am",timezone:null,state:"closed",valign:{value:"center",reflect:true},align:{value:"center",reflect:true},closeLabel:"Close",saveLabel:"Save"},observe:{"start end":"updateFields","startDate endDate":"validateDates"},computed:{duration:"getDuration(startDate,endDate)",datesValid:"areDatesValid(startDate,endDate)"},ready:function(){if(this.timeFormat&&this.timeFormat.indexOf("a")){this.timeOnlyFormat=this.timeFormat.replace(" a","")}if(!this.startTime){this.startTime=moment().startOf("day").format(this.timeOnlyFormat);this.startTimePeriod=moment().startOf("day").format("a")}if(!this.startDate)this.startDate="";if(!this.endTime){this.endTime=moment().endOf("day").format(this.timeOnlyFormat);this.endTimePeriod=moment().endOf("day").format("a")}if(!this.endDate)this.endDate=""},rangeValueChanged:function(oldRangeValue,newRangeValue){var idx=this._rangePresets.map(function(p){return p.value}).indexOf(newRangeValue);var range=this._rangePresets[idx];if(range){this.startDate=range.range.start.format(this.dateFormat);this.endDate=range.range.end.format(this.dateFormat)}},rangePresetsChanged:function(oldRangePresets,newRangePresets){this._rangePresets=this.rangePresets.map(function(range,i){var start=moment(range.start);var end=moment(range.end);return{index:i,range:moment.range(start,end),label:range.name,value:"range"+i}})},calendarFilter:{toDOM:function(value){var m=moment(value);if(m.isValid()){return m.format(this.dateFormat)}return value},toModel:function(value){var m=moment(value);if(m.isValid()){return m.format(this.dateFormat)}return value}},handleTap:function(e){if(e.target===this.$.startCalendar){this.$.startCalendar.date=e.detail.date}if(e.target===this.$.endCalendar){this.$.endCalendar.date=e.detail.date}},areDatesValid:function(){var sd=moment(this.startDate,this.dateFormat,true);var ed=moment(this.endDate,this.dateFormat,true);return sd.isValid()&&ed.isValid()},validateDates:function(){var sd=moment(this.startDate,this.dateFormat,true);var allowedStart=_undef(this.allowedStart)&&moment(this.allowedStart);if(sd.isValid()&&allowedStart){if(sd.isBefore(allowedStart)){this.async(function(){this.startDate=allowedStart.format(this.dateFormat)})}}var ed=moment(this.endDate,this.dateFormat,true);var allowedEnd=_undef(this.allowedEnd)&&moment(this.allowedEnd);if(ed.isValid()&&allowedStart.isValid()){if(ed.isAfter(allowedEnd)){this.async(function(){this.endDate=allowedEnd.format(this.dateFormat)})}}if(this.areDatesValid()&&this.useRange&&this._rangePresets){var found=false;this._rangePresets.forEach(function(preset){if(preset.range.start.isSame(sd,"day")&&preset.range.end.isSame(ed.add(1,"second"),"day")){this.rangeValue=String(preset.value);found=true}},this);if(!found){this.rangeValue=""}}},updateFields:function(){this.reset()},reset:function(start,end){if(!start)start=this.start;if(!end)end=this.end;var s=moment(start);var e=moment(end);if(s.isValid()){this.startDate=s.format(this.dateFormat);this.startTime=s.format(this.timeOnlyFormat);this.startTimePeriod=s.format("a")}if(e.isValid()){this.endDate=e.format(this.dateFormat);this.endTime=e.format(this.timeOnlyFormat);this.endTimePeriod=e.format("a")}},getDuration:function(date1,date2){if(this.$&&this.$.footer&&this.useDuration){this.$.footer.showMessage()}var duration=moment.duration(moment.range(date1,date2).diff("second"),"second").humanize();if(duration==="a few seconds"){if(this.$&&this.$.footer){this.$.footer.hideMessage()}return""}return"About "+duration},displayItem:function(value){if(value){return"block"}else{return"none"}},open:function(){this.state=this.STATE_OPENED},close:function(){this.state=this.STATE_CLOSED},stateChanged:function(oldVal,newValue){if(oldVal===this.STATE_OPENED&&newValue===this.STATE_CLOSED){this.fire("closed");if(this.resetOnClose){this.reset()}}else if(newValue===this.STATE_OPENED){this.fire("opened")}},timezonesChanged:function(oldTimezones,newTimezones){if(this.useTimezone&&this.timezones);this._timezones=this.timezones.slice()},timezoneSearchChanged:function(oldTimezoneSearch,newTimezoneSearch){if(this.useTimezone&&this.timezones){this._timezones=this.timezones.filter(function(t){return t.label.toLowerCase().includes(newTimezoneSearch.toLowerCase())})}},closeFilter:function(instance,e){if(Array.prototype.slice.call(e.path).indexOf(this)>-1||Array.prototype.slice.call(e.path).indexOf(this.$.closePanel.target)>-1){e.stopImmediatePropagation()}else{instance.closeHandler()}},keyHandler:function(e){var c=String.fromCharCode(e.keyCode);var ddl=this.shadowRoot.querySelector("#"+e.target.id.replace("Time","Period"));if(c==="A"){e.preventDefault();ddl.value="am"}else if(c==="P"){e.preventDefault();ddl.value="pm"}},closeLinkHandler:function(e){e.preventDefault();this.close();if(this.resetOnClose){this.reset()}},save:function(e){var sd=moment(this.startDate);var st=moment(this.startTime+" "+this.startTimePeriod,this.timeFormat);sd.add({hours:st.hours(),minutes:st.minutes()});this.start=sd.toDate();var ed=moment(this.endDate);var et=moment(this.endTime+" "+this.endTimePeriod,this.timeFormat);ed.add({hours:et.hours(),minutes:et.minutes()});this.end=ed.toDate();this.fire("saved",{start:this.start,end:this.end});this.close()}})})();</script></polymer-element></body></html>
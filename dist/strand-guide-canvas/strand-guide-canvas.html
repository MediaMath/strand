<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt
 --><html><head><meta charset="UTF-8"></head><body><div hidden by-vulcanize=""><link rel="import" href="../../bower_components/polymer/polymer.html"><script>(function(a){a.BitMask=function(){var c=[].slice.call(arguments);this.data=[];for(var d=0;d<c.length;d++)this[c[d]]=1<<d,this.data[1<<d]=c[d]}})(window.StrandLib=window.StrandLib||{});</script><script>(function(a){function b(c,d,e,f){this.x=c,this.y=d,this.width=e,this.height=f}b.fromElement=function(c){if(c&&c.getBoundingClientRect){var d=c.getBoundingClientRect();return new b(d.left,d.top,d.width,d.height)}return new b(0,0,0,0)},b.fixBits=function(c,d,e){d&=e;var f=c&b.SIDE.CENTER,g=c&b.SIDE.VCENTER;return f||g?d&&(c|=d^e,g&&(c&=~b.SIDE.VCENTER),f&&(c&=~b.SIDE.CENTER)):0!=(d&e)&&(d&e)!==e&&(c=c&~e|c^e),c},b.SIDE=new a.BitMask("TOP","BOTTOM","LEFT","RIGHT","CENTER","VCENTER"),b.prototype={get left(){return this.x},set left(c){this.x=c},get right(){return this.x+this.width},set right(c){this.x=c-this.width},get top(){return this.y},set top(c){this.y=c},get bottom(){return this.y+this.height},set bottom(c){this.y=c-this.height},get center(){return this.x+this.width/2},set center(c){this.x=c-this.width/2},get vcenter(){return this.y+this.height/2},set vcenter(c){this.y=c-this.height/2},clone:function(){return new b(this.x,this.y,this.width,this.height)},outside:function(c){var d=0,e=b.SIDE;return this.left<c.left&&(d|=e.LEFT),this.right>c.right&&(d|=e.RIGHT),this.top<c.top&&(d|=e.TOP),this.bottom>c.bottom&&(d|=e.BOTTOM),d},toCSS:function(c,d){return c&&c.style&&(d?(c.style.left=this.left+"px",c.style.top=this.top+"px"):(c.style.left=Math.round(this.left)+"px",c.style.top=Math.round(this.top)+"px")),this},positionRelative:function(c,d){var e=b.SIDE;return e.LEFT&d&&(this.right=c.left),e.RIGHT&d&&(this.left=c.right),e.TOP&d&&(this.bottom=c.top),e.BOTTOM&d&&(this.top=c.bottom),e.CENTER&d&&(this.center=c.center),e.VCENTER&d&&(this.vcenter=c.vcenter),this},subtract:function(c){this.x-=c.x,this.y-=c.y},flipV:function(){this.y=-this.y},flipH:function(){this.x=-this.x},alignRelative:function(c,d){var e=b.SIDE;return e.LEFT&d&&(this.left=c.left),e.RIGHT&d&&(this.right=c.right),e.TOP&d&&(this.bottom=c.bottom),e.BOTTOM&d&&(this.top=c.top),e.CENTER&d&&(this.center=c.center),e.VCENTER&d&&(this.vcenter=c.vcenter),this}},a.Rectangle=b})(window.StrandLib=window.StrandLib||{});</script></div><dom-module id="strand-guide-canvas"><template><style>:host{position:relative;display:block}:host([hidden]) #blocker{display:none}#blocker{position:fixed;left:0;top:0;bottom:0;right:0}</style><canvas id="canvas"></canvas></template></dom-module><script>(function(a){function b(e,f,g,i,j,k,l){j||(j=0),k||(k=2*Math.PI),e.save(),e.beginPath(),e.arc(f,g,i,j,k),l&&(e.strokeStyle=l),e.stroke(),e.restore()}function c(e,f,g,i,j,k){i<2*k&&(k=i/2),j<2*k&&(k=j/2),e.save(),e.beginPath(),e.moveTo(f+k,g),e.arcTo(f+i,g,f+i,g+j,k),e.arcTo(f+i,g+j,f,g+j,k),e.arcTo(f,g+j,f,g,k),e.arcTo(f,g,f+i,g,k),e.closePath(),e.restore()}var d=StrandLib.Rectangle;a.Guide=Polymer({is:'strand-guide-canvas',behaviors:[StrandTraits.WindowNotifier],properties:{hidden:{type:Boolean},opacity:{type:Number,value:0.3},data:{type:Array},currentStep:{type:Number,notify:!0,observer:'_currentStepChanged'},spotlightType:String,spotlightOffset:Number,cornerRadius:Number},resize:function(){this.hidden||this.debounce('update-canvas',this._updateCanvas)},scroll:function(){this.hidden||this.debounce('update-canvas',this._updateCanvas)},_currentStepChanged:function(){this.currentStep<=this.data.length-1&&this._updateCanvas()},_updateCanvas:function(){if(this.data){var e=this.data[this.currentStep].targetRef,f=d.fromElement(e),g=this.$.canvas,i=g.getContext('2d'),j=i.canvas.width=window.innerWidth,k=i.canvas.height=window.innerHeight;if(this.spotlightRadius,this.spotlightOffset,g.width=j,g.height=k,i.fillStyle='rgba(0,0,0,'+this.opacity+')',i.fillRect(0,0,j,k),i.globalCompositeOperation='destination-out',i.fillStyle='red','circle'===this.spotlightType){var l=f.width>f.height?f.width:f.height;b(i,f.x+f.width/2,f.y+f.height/2,l/2+this.spotlightOffset)}else c(i,f.x-this.spotlightOffset,f.y-this.spotlightOffset,f.width+2*this.spotlightOffset,f.height+2*this.spotlightOffset,this.cornerRadius);i.fill()}}})})(window.Strand=window.Strand||{});</script></body></html>
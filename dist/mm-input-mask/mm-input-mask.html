<!--
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

--><html><head><link rel="import" href="../../../polymerLegacy/polymer.html"><link rel="import" href="../shared/js/datautils.html"><link rel="import" href="../shared/js/fontloader.html"><link rel="import" href="../shared/fonts/fonts.html"><link rel="import" href="../shared/js/measure.html"><link rel="import" href="../mm-input/mm-input.html"><link rel="import" href="../mm-item-notifier/mm-item-notifier.html"></head><body><polymer-element name="mm-input-mask" attributes="" extends="mm-input" assetpath=""><template><style type="text/css">._mm_text_input{box-sizing:border-box;border:1px solid #CCC;border-radius:4px;background-color:#fff;box-shadow:inset 1px 1px 3px rgba(0,0,0,.125);width:100%;color:#333;font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-weight:400;font-size:13px!important;line-height:15px!important;padding:6px 10px;overflow:hidden;outline:0;margin:0;resize:none}._mm_text_input::-webkit-input-placeholder{font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-style:italic;font-weight:400}._mm_text_input::-moz-placeholder{font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-style:italic;font-weight:400}._mm_text_input:-moz-placeholder{font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-style:italic;font-weight:400}._mm_text_input:-ms-input-placeholder{font-family:Arimo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;font-style:italic;font-weight:400}._mm_text_input.monospace{font-family:monospace}._mm_text_input.monospace::-webkit-input-placeholder{font-family:monospace}._mm_text_input.monospace::-moz-placeholder{font-family:monospace}._mm_text_input.monospace:-moz-placeholder{font-family:monospace}._mm_text_input.monospace:-ms-input-placeholder{font-family:monospace}._mm_text_input:focus,._mm_text_input[forceFocus]{border-color:#98cbf3;outline:0;box-shadow:0 0 6px rgba(171,210,246,.83)}._mm_text_input.invalid{border-color:#f85252}._mm_text_input.invalid:focus{border-color:#f85252;outline:0;box-shadow:0 0 6px rgba(171,210,246,.83)}::content group,sep{display:none}polyfill-next-selector{content:'._mm_text_input:not(.mask)'}::content ._mm_text_input:not(.mask){color:rgba(255,255,255,0)}polyfill-next-selector{content:'._mm_text_input:not(.mask)::placeholder'}::content ._mm_text_input:not(.mask)::placeholder{color:rgba(255,255,255,0)}polyfill-next-selector{content:'._mm_text_input:not(.mask)::-webkit-input-placeholder'}::content ._mm_text_input:not(.mask)::-webkit-input-placeholder{color:rgba(255,255,255,0)}._mm_text_input:not(.mask)::shadow ::-webkit-input-placeholder{color:rgba(255,255,255,0)}polyfill-next-selector{content:'._mm_text_input:not(.mask)::-moz-placeholder'}::content ._mm_text_input:not(.mask)::-moz-placeholder{color:rgba(255,255,255,0)}polyfill-next-selector{content:'._mm_text_input:not(.mask):-ms-input-placeholder'}::content ._mm_text_input:not(.mask):-ms-input-placeholder{color:rgba(255,255,255,0)}#pseudo{box-sizing:border-box;position:absolute;width:100%;height:29px;font-weight:400;font-size:13px!important;line-height:29px!important;padding:0 10px}#pseudo .mask{background:rgba(255,255,255,0);border:none;box-shadow:none;width:auto;padding:0!important;-webkit-transition:width .3s ease-in-out;-moz-transition:width .3s ease-in-out;transition:width .3s ease-in-out}#pseudo .mask:focus{outline:0;background:0 0;box-shadow:none}#pseudo .sep{padding:6px 0}#pseudo .placeholder{color:#a9a9a9}</style><div id="pseudo"><template repeat="{{maskConfig}}"><template if="{{type === 1}}"><input id="mini{{index}}" type="text" size="{{max}}" maxlength="{{max}}" class="_mm_text_input mask" disabled?="{{disabled}}" value="{{value}}" on-focus="{{handleInputFocus}}" on-blur="{{handleBlur}}" on-keydown="{{cellKey}}" on-keyup="{{cellVal}}" placeholder="{{placeholder}}" style="{{style | contentWidth(value, placeholder, loaded) | styleObject}}"></template><template if="{{type === 0}}"><span class="{{style | tokenList}}">{{value}}</span></template></template></div><shadow></shadow><mm-item-notifier on-added="{{handleUpdate}}" on-removed="{{handleUpdate}}" on-modified="{{handleUpdate}}"><content id="content" select="group,sep"></content></mm-item-notifier></template><script>(function(){var _types={SEP:0,GROUP:1};var _restrict={alpha:/[A-Za-z]+/g,numeric:/\d+/gi,alphaNumeric:/[A-Za-z\d]+/g,all:/.+/g};var _applyReg=function(reg,val){if(reg){reg.lastIndex=0;return reg.test(val)}return false};var _rules={hour12:function(char,input,group,field){var val=input+char,first=field.selectionStart===0,second=field.selectionStart===1,imp=parseInt(char);if(first){if(imp>1){field.value="0"+input;return false}}else if(second){if(imp>2&&parseInt(input)===1){field.value=input+"2";return false}}return true},hour24:function(char,input,group,field){var val=input+char,first=field.selectionStart===0,second=field.selectionStart===1,imp=parseInt(char)},minutes:function(char,input,group,field){var first=field.selectionStart===0;var imp=parseInt(char);if(first){if(imp>5){field.value="5";return false}}return true},range:function(char,input,group,field){if(input.length<group.max){return true}var i=parseInt(input),rng=_parseRange(group.args);return i>=rng[0]&&i<=rng[1]},exact:function(char,input,group,field){return input===group.args},all:function(){return true}};var _parseRange=function(range){if(!range)return[];return range.split("-").map(function(i){return parseInt(i)})};var _groupRange=function(range){if(!range)return[];if(_isRange(range)){return _parseRange(range)}else{var s=parseInt(range);return[s,s]}};var _isRange=function(range){return range.indexOf("-")!==-1};Polymer("mm-input-mask",{ver:"<<version>>",publish:{mask:"",rules:null,restrict:null},created:function(){this.loader=new FontLoader;this.loader.add("Arimo")},ready:function(){this.super();if(!this.rules){this.rules=_rules}if(!this.restrict){this.restrict=_restrict}this.parseMask()},domReady:function(){this.$.input.setAttribute("disabled",true);this.updateGroups()},attached:function(){this.$.input.addEventListener("focus",this.handleFocus.bind(this));this.$.input.addEventListener("blur",this.handleBlur.bind(this))},detached:function(){this.$.input.removeEventListener("focus");this.$.input.removeEventListener("blur")},parseMask:function(){this.sepsLen=0;var nodes=DataUtils.clone(this.$.content.getDistributedNodes()),groups=[],seps=[];this.maskConfig=nodes.map(function(node,index){switch(node.nodeName){case"GROUP":var rng=_groupRange(node.getAttribute("size")),rule=this.rules[node.getAttribute("rule")],restrict=this.restrict[node.getAttribute("restrict")],auto=node.getAttribute("autofill"),args=node.textContent.trim(),style={width:"auto"};if(restrict!==_restrict.numeric)style={};var o={index:index,max:rng[1],min:rng[0],rule:rule,restrict:restrict,args:args,auto:auto,type:_types.GROUP,style:style,loaded:false,contentWidth:this.contentWidthHandler};groups.push(o);return o;case"SEP":var chars=node.getAttribute("chars");this.sepsLen+=chars.length;var s={type:_types.SEP,value:chars,style:{sep:true,placeholder:true}};seps.push(s);return s}},this);this.seps=seps;this.groups=groups;this.loader.add("Arimo").then(function(e){this.arimoLoaded=true;this.async(function(){this.groups.forEach(function(group){group.loaded=true},this)})}.bind(this))},contentWidthHandler:function(style,val,placeholder,loaded){var w=0;var check=val||placeholder||"";while(check.length<this.max){check+="S"}if(!val&&placeholder){w=Measure.textWidth(null,check,"italic 13px Arimo")}else{w=Measure.textWidth(null,check,"13px Arimo")}style.width=w+"px";return style},placeholderChanged:function(oldPlaceholder,newPlaceholder){this.applyValue(this.chunkValue(this.placeholder,"placeholder"),"placeholder")},valueChanged:function(oldValue,newValue){if(newValue){var placeholder=newValue.length<=this.sepsLen;this.seps.forEach(function(sep){sep.style={sep:true,placeholder:placeholder}},this)}if(this.ignoreInternal){this.ignoreInternal=false;return}this.applyValue(this.chunkValue(newValue))},chunkValue:function(value,type){if(!type)type="value";if(value===""||value===null){return[]}else{var sepReg="["+this.seps.map(function(sep){return sep.value}).join("")+"]+",srcPath=Path.get("restrict.source"),base=this.maskConfig.map(function(item){switch(item.type){case _types.GROUP:item=this.groups.filter(function(g){return g.index===item.index})[0];var src=srcPath.getValueFrom(item)||".*";if(type==="placeholder"){src=".*"}if(item.min!==item.max){return"("+src+")"}else{src=src.replace("+","");src=src.replace("*","");return"("+src+"{"+item.min+"})"}break;case _types.SEP:return sepReg}},this),r=new RegExp(base.join(""),"g"),res=r.exec(value);if(res){res.shift();return Array.prototype.slice.apply(res)}return[]}},applyValue:function(valArray,type){if(!type)type="value";if(!valArray)valArray=[];var g,value;for(var i=0;i<this.groups.length;i++){g=this.groups[i];value=valArray.length>0?valArray[i]:"";g[type]=value}},updateGroups:function(){this.groupSel=this.groups.map(function(o){return this.shadowRoot.querySelector("#mini"+o.index)}.bind(this))},handleFocus:function(e){this.updateGroups();this.handleInputFocus()},handleInputFocus:function(e){this.$.input.setAttribute("forceFocus",true)},handleBlur:function(e){this.$.input.removeAttribute("forceFocus")},validateGroup:function(e,target){var val=String.fromCharCode(e.keyCode);var group=this.getGroup(target);var restrict=group.restrict&&_applyReg(group.restrict,val);var rule=group.rule&&group.rule(val,target.value,group,target);return restrict&&rule},focusLeft:function(target){var idx=this.groupSel.indexOf(target);if(idx>0){idx--;this.groupSel[idx].focus();return this.groupSel[idx]}return target},focusRight:function(target){var idx=this.groupSel.indexOf(target);idx++;if(idx<this.groupSel.length){this.groupSel[idx].focus();return this.groupSel[idx]}return target},handleFill:function(target){var group=this.getGroup(target),delta=group.max-target.value.length;if(group.auto&&delta>0){var o=new Array(delta+1).join(group.auto);var val=target.value;target.value=o+val}},getGroup:function(target){return this.groups[this.groupSel.indexOf(target)]},cellKey:function(e){var target=e.target,code=e.keyCode,alpha=code>=48&&code<=57,numeric=code>=65&&code<=90,alphaNumeric=alpha||numeric,left=code===37,right=code===39,back=code===8,tab=code===9,selLength=target.selectionEnd-target.selectionStart,max=this.getGroup(e.target).max;if(back&&target.value.length===0&&selLength===0){target=this.focusLeft(target)}else if(alphaNumeric&&target.value.length===max&&selLength===0){target=this.focusRight(target)}else if(left&&e.target.selectionStart===0){target=this.focusLeft(target)}else if(right&&e.target.selectionStart===max){target=this.focusRight(target)}if(alphaNumeric&&!this.validateGroup(e,target)&&selLength===0){e.preventDefault();if(target.value.length===max)this.focusRight(target)}if(tab){this.handleFill(target)}},cellVal:function(e){var val=this.maskConfig.reduce(function(prev,item){return item.value?prev+item.value:prev},"");if(val!==this.value){this.ignoreInternal=true}this.value=val}})})();</script></polymer-element></body></html>